(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();const d=1080,p=540,E=380,v=360;let e={image:null,scale:1,offsetX:0,offsetY:0,isDragging:!1,dragStartX:0,dragStartY:0,lastOffsetX:0,lastOffsetY:0,frameImage:null};const l=document.getElementById("uploadZone"),h=document.getElementById("fileInput"),y=document.getElementById("previewContainer"),s=document.getElementById("previewCanvas"),c=s.getContext("2d"),f=document.getElementById("zoomSlider"),g=document.getElementById("zoomValue"),C=document.getElementById("resetBtn"),X=document.getElementById("downloadBtn"),Y=document.getElementById("changePhotoBtn");async function D(){e.frameImage=await w("/assets/frame.png"),s.width=d,s.height=d,S(),console.log("Campaign photo editor initialized!")}function w(t){return new Promise((n,i)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>n(a),a.onerror=i,a.src=t})}function S(){l.addEventListener("click",()=>h.click()),h.addEventListener("change",O),l.addEventListener("dragover",B),l.addEventListener("dragleave",R),l.addEventListener("drop",M),s.addEventListener("mousedown",x),s.addEventListener("mousemove",N),s.addEventListener("mouseup",L),s.addEventListener("mouseleave",L),s.addEventListener("touchstart",T,{passive:!1}),s.addEventListener("touchmove",_,{passive:!1}),s.addEventListener("touchend",z),f.addEventListener("input",A),C.addEventListener("click",V),X.addEventListener("click",U),Y.addEventListener("click",F)}function O(t){const n=t.target.files[0];n&&I(n)}function B(t){t.preventDefault(),l.classList.add("dragover")}function R(t){t.preventDefault(),l.classList.remove("dragover")}function M(t){t.preventDefault(),l.classList.remove("dragover");const n=t.dataTransfer.files[0];n&&n.type.startsWith("image/")&&I(n)}function I(t){const n=new FileReader;n.onload=async i=>{try{e.image=await w(i.target.result),P(),u()}catch(a){console.error("Error loading image:",a)}},n.readAsDataURL(t)}function P(){l.classList.add("hidden"),y.classList.remove("hidden"),e.image.width/e.image.height;const t=Math.min(e.image.width,e.image.height);e.scale=v*2/t,e.scale<.5&&(e.scale=.5),e.scale>2&&(e.scale=2);const n=Math.round(e.scale*100);f.value=Math.min(200,Math.max(50,n)),g.textContent=`${f.value}%`,e.offsetX=0,e.offsetY=0}function b(){l.classList.remove("hidden"),y.classList.add("hidden"),e.image=null,h.value=""}function u(){if(!e.image)return;c.fillStyle="#CC0000",c.fillRect(0,0,d,d),c.save(),c.beginPath(),c.arc(p,E,v,0,Math.PI*2),c.closePath(),c.clip();const t=e.image.width*e.scale,n=e.image.height*e.scale,i=p-t/2+e.offsetX,a=E-n/2+e.offsetY;c.drawImage(e.image,i,a,t,n),c.restore(),e.frameImage&&c.drawImage(e.frameImage,0,0,d,d)}function x(t){e.isDragging=!0,e.dragStartX=t.clientX,e.dragStartY=t.clientY,e.lastOffsetX=e.offsetX,e.lastOffsetY=e.offsetY,s.style.cursor="grabbing"}function N(t){if(!e.isDragging)return;const n=s.getBoundingClientRect(),i=d/n.width;e.offsetX=e.lastOffsetX+(t.clientX-e.dragStartX)*i,e.offsetY=e.lastOffsetY+(t.clientY-e.dragStartY)*i,u()}function L(){e.isDragging=!1,s.style.cursor="grab"}function T(t){t.preventDefault();const n=t.touches[0];e.isDragging=!0,e.dragStartX=n.clientX,e.dragStartY=n.clientY,e.lastOffsetX=e.offsetX,e.lastOffsetY=e.offsetY}function _(t){if(t.preventDefault(),!e.isDragging)return;const n=t.touches[0],i=s.getBoundingClientRect(),a=d/i.width;e.offsetX=e.lastOffsetX+(n.clientX-e.dragStartX)*a,e.offsetY=e.lastOffsetY+(n.clientY-e.dragStartY)*a,u()}function z(){e.isDragging=!1}function A(t){e.scale=parseInt(t.target.value)/100,g.textContent=`${t.target.value}%`,u()}function V(){if(e.image){const t=Math.min(e.image.width,e.image.height);e.scale=v*2/t,e.scale<.5&&(e.scale=.5),e.scale>2&&(e.scale=2);const n=Math.round(e.scale*100);f.value=Math.min(200,Math.max(50,n)),g.textContent=`${f.value}%`}else e.scale=1,f.value=100,g.textContent="100%";e.offsetX=0,e.offsetY=0,u()}function F(){b()}function U(){const t=document.createElement("a");t.download="no-boat-no-vote-campaign-photo.png",t.href=s.toDataURL("image/png",1),document.body.appendChild(t),t.click(),document.body.removeChild(t)}D();
